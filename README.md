
<div align="center">
  <h1> 排程議題與方法基礎概念介紹 📅</h1>
  <p align="center">
    ✍️ <a href="https://hackmd.io/@pputzh5cRhi6gZI0csfiyA/H1ejIyxHR"> 作者: 鄭永誠</a> • 
    ✉️ <a href="mailto:jason0304050607@gmail.com">信箱</a> • 
    🧑‍🤝‍🧑 <a href="https://www.dalabx.com.tw//"> 合作夥伴: 紫式大數據決策 </a> • 
    👫 <a href="https://moraleai.com/"> 我的朋朋: Morale AI </a> 
  </p>
</div>
<br/>

本文章將會帶你了解什麼是排程與派工(scheduling and dispatching)，  
除了希望讓你具備最基礎的概念外，  
也會同時介紹我們要如何利用演算法、啟發式演算法來解決排程相關對應問題，  
都會以最簡單的例子開始一步步讓你

內容會包含:
- 排程在做什麼?
- 為什麼會需要用演算法去求解?
- 實務狀況排程可能會考量哪些項目?
- 排程模組應如何規劃設計?

額外會補充:
- 生管基礎概念，主排程(MPS)、物料需求計畫(MRP)、排程(Scheduling)、派工(Dispaching)等概念
- 排程實務面臨挑戰和狀況
- 其他解決方案，系統模擬(Simulation)、數學規劃(Mathematical Programming)、啟發式演算法、rule-based、強化學習
--------------------------
## 簡介
排程規劃，最最最核心概念其實就是在決定<span style="color:Navy"><strong>工作順序</strong></span> 與 <span style="color:Navy"><strong>資源分配</strong></span>  
而要達成的最最最基本目標就是<span style="color:Navy"><strong>滿足交期</strong></span> (在目標時間內完成)  

你可以想像你要負責煮晚餐，必須要趕在7點上飯菜，  
必須要完成煮飯跟炒菜兩件事。  

這個時候，  
你會選擇先把米洗好放到電鍋去蒸還是會先去炒菜呢?
一般情況應該會是先去洗米蒸飯、再炒菜，因為蒸飯要的時間很久，
你如果先炒菜的話，米飯可能會趕不上7點需求






--------------------------
## 排程資料基本名詞

注意，不同系統、產業用詞可能會有所出入，
此部份只列出最基本的使用名詞

### 常見基本欄位名稱

- **工單號/製令 (work order)** :  
每張工單的基本編號，為唯一值，代表一個要生產需求  
工單可以進一步分成：<span style="color:Brown">MPS工單 (主生產排程工單)</span>，即根據預測和計劃需求生成的訂單；<span style="color:Brown">WIP工單 (在製品工單)</span>，即已經進入生產過程中的工單。這些分類將在後續部分進一步解釋。

- **料號 (material number)** :  
生產的產品類型，即生產的種類，可能是成品料號 (最終成品，像是手機) 或是半成品料號 (廠內製造的半成品，像是手機內印刷電路板)  
成品料號通常用於最終交付給客戶的產品，而半成品料號則是在生產過程中進一步加工或組裝的中間產品。

- **交期/計畫出貨時間 (Due Date / Planned Shipment Date)** :  
該工單預期需要完成的時間，是計劃生產和出貨的重要依據，影響到生產優先順序的決定，並對應到客戶的需求交期。  

- **生產數量/單位 (Production Quantity / Unit)** :  
生產數量是指工單要求生產的特定料號的數量，通常會以單位如件、套或公斤來表示，會直接影響需要分配的資源和所需的生產時間。  

- **工作中心 (machine center / operation)** :   
工作中心代表一個特定的生產單位，可能由類似或相同類型的機台組成。  
通常對應於生產流程中的一個步驟。不同的工作中心有不同的生產能力和約束條件，需要進行有效的排程和資源分配以達到最佳生產效率。

- **生產步驟/工序/站點/作業順序/作業號碼** :  
對應一個料號的生產步驟(記錄方式可能像是0010, 0020, 0030...)，通常一個作業步驟會對應到一個工作中心

- **標準工時/作業時間 (Standard Time)** :  
標準工時是指完成一項特定工作(可能是一個生產步驟或一個產品生產週期)在標準條件下完成一定單位數量下所需花的時間，是生產排程和成本核算的重要依據

### 其他常見名詞說明
- **整備時間 (Setup Time)** :    
指將機台從上一個產品的生產狀態轉換為下一個產品所需的準備時間，可能包括清理、模具更換、機台調整等，通常不同料號/產品 之間所需要的整備時間不一樣

- **等候時間限制 (Queue Time Limit / Q-time)** :  
一個料號在兩個生產步驟間，根據製程與產品特性可能會設定中間能間隔的時間上限，若超過此時間限制必須重新加工或是報廢

- **搬運時間 (Handling Time)**  :  
從一個工作中心或工序搬運到下一個工作中心或工序所需的時間。

- **批量大小 (Batch Size)**  :  
批量大小是指每次生產過程中生產的產品數量，可能會跟製程類型、製具載具、製程間等有關連，  
進一步又可分成serial batching (s-batch) 或 parallel batching (p-batch) 

  |  | Serial Batching (S-Batch) | Parallel Batching (P-Batch)  |
  |-|-|-|
  | 處理方式 | 串行，依次處理每個工序 | 並行，不同工序同時處理  |
  | 適用情境 | 小批量生產，高精密度加工或品質管控要求高 | 大批量生產，多工序並行作業  |
  | 等候時間 | 高，下一工序等待前一工序完成 | 低，多個工序可以同時進行  |
  | 資源利用率 | 低，工序間可能存在空閒時間 | 高，資源同時運作，提高生產效率  |
  | 排程複雜度 | 低，相對簡單的排程管理 | 高，需要更複雜的生產計劃  |

- **部分轉移批量/重疊生產 (Transfer Batch Size / Overlapping Production)** :  
在生產過程中，當一個工序正在加工一個批次的部分數量時，不必等待整個批次全部完成就可以開始下一工序的加工。  
假設作業順序是 A → B  ，分別要花 4小時、2小時  
實際上在A站點時可能生產 3 小時(部分數量完成A的流程或累積一定數量單位) B站點就可以開始執行部分A的完成品，  
最終生產時間就會變成是 5 小時而非 4+2=6 小時  
特別適用於需要多道工序且每道工序處理時間差異較大的情況，例如金屬加工和電子裝配等行業  
可以減少在製品的數量和佔用空間，提高機台的利用率和整體生產線的流暢性，並靈活調整轉移批量的大小  


- **停機/禁線時間 (Downtime)** :  
生產機台、產線可能會有對應的**計劃性停機時間 (Planned Downtime)** 或 **非計劃性停機時間 (Unplanned Downtime)**  
代表機台或設備無法進行生產作業的特定時間段  
計畫性的停機可能包含例行預防性維護、預測性維護、設備保養、模具更換...  
非計劃性的停機可能包含機台故障、物料短缺、人力不足等  

- **凍結期 (Freeze Period)** :  
凍結期用來描述在一定時間範圍內，生產計劃或排程不得更改的時段，  
這個時段的設置通常是為了確保生產穩定性，避免頻繁變更對生產造成的干擾和不穩定。  
至於排程時其在處理邏輯類似禁線時間，代表特定機台、機群在指定時間已分配給特定工作，這個時間段不能排入其他工單  
這個時間範圍的長度根據生產環境、行業特性、產品類型和客戶需求的不同而有所變化。  
設置凍結期的目的是為了降低計劃變更帶來的不確定性，穩定生產節奏，並確保資源的有效利用。  
理想情況是結合**滾動計劃 (Rolling Planning)**的方式，每次排程逐步更新計劃而非大幅調整

- **專機專線 / 主要機台、次要機台 / 機台配適度 (Dedicated Machine)** :  
實務狀況不同工單/料號可能會安排至特定的機台或產線上生產，  
因為不同的機台或產線可能量率、生產時間會有所出入，甚至是適合生產不同的料號種類，  
會出現專機專線的情況可能包含客戶指定、基於歷史生產紀錄(量率和生產數量)、基於測試結果(e.g.只曾經在A產線上測試生產過，故只能安排在A產線生產)等  

- **輔助資源 (Auxiliary Resource)** :
此處泛指生產過程中除了主要生產設備(機台)之外，其他相關影響生產時間、同時生產數量、需求資源的限制，  
常見如模具、製具，即便當前該工作中心下有3台機台可生產，但可能生產該料號的模具只有2副，  
故同時能生產該料號的同時數量上限就只能是2，若此時要排入其他要使用相同模具的工作，就必須等這2個模具空出才能排入，  
其他還包含載具、人力資源、製工具、設施空間(WIP存放空間)、運輸系統、檢測設備...  
故應對輔助資源限制需要通過精確的計劃規劃，才能確保資源的及時供應和合理配置  



### 常見資料表
此處只大概說明一些可能會用到的表的基本概念，實務上可能包含更多資訊或拆由不同表紀錄

- **途程表 (Routing Table)** :   

  -  **功能**:   
  記錄產品的生產流程，包含各工序步驟、所需的工作中心或設備、標準工時、準備時間等

  -  **用途**:
  確認工單的生產步驟和計算各站點生產所需時間

  -  **基本範例**:
      | 欄位 | 說明 | 備註  |
      |-|-|-|
      | BOM編號 | 物料清單的唯一識別碼，用來區分不同產品或組件的 BOM 記錄 | PK  |
      | 廠別版本 | 可能包含生產廠別、生產版本或其他單位，針對同一產品，不同版本下的BOM可能不同 | PK  |
      | 產品料號、母項目料號 | 成品或組件的料號，描述該產品 BOM 的母項 | PK  |
      | 零件料號 | 該 BOM 中所包含的每個零件或組件的料號 |   |
      | 階層 | 展開層級，描述該零件或組件所在的層級 |  如1=成品，2=子件，3=子件的子件... |
      | 層級下編號 | 該層級下零件或組件的唯一識別碼，用於區分同一層級下的不同零件或組件| PK，通常是自動生成的流水號  |
      |零件料號|該 BOM 中所包含的每個零件或組件的料號，描述該物料的唯一識別碼	||
      |替代群組編號|替代群組的識別碼，用於區分哪些料號互為替代料|如果此欄位有值，表示該物料有替代選項|
      |替代料號	|替代料的料號，與主料號在替代群組內為互替關係|可以是多個替代料號|
      |替代優先順序|替代料的使用順序||
      |對應上層級編號	|與上一層級對應的編號，表示該零件或組件與其父項目之間的關係|	|
      | 基礎數量 | 生產成品所需的該零件數量 |   |
      | 單位 | 零件數量的單位，例如：件、公斤、米等 |   |
      | 損耗率/報廢率 | 零件在生產過程中的損耗百分比，影響實際物料需求 |   |
      | 生效日期 | BOM 記錄的有效起始日期，表示此 BOM 何時開始生效 |   |
      | 失效日期 | BOM 記錄的有效結束日期，表示此 BOM 何時結束生效 |   |


- **BOM表 / 物料清單 (Bill of Material)** :  

  -  **功能**:   
  記錄生產開產品所需要的半成品物料、零組件、原物料等，  
  詳細展開並敘述其數量、階層關係等信息，  
  舉例而言，根據客戶訂單，要生產1份大麥克套餐(成品物料)，  
  BoM表可能就會記錄生產一份大麥克套餐需要一杯可樂、一個漢堡、一包薯條，  
  而漢堡部分又會再展開需要一包裝紙、兩個麵包、一片肉餅、兩片生菜、20g的醬料...  

  -  **用途**:
  1. 詳細說明了產品的結構，幫助設計工程師確保設計的完整性 (mBOM)
  2. 可以用來計算各種零件的需求數量，並進行生產排程
  3. 根據主生產計劃（MPS）和BOM表可展開物料需求計畫 (MRP)  
     (MRP可理解為就像是將各個套餐部分展開，讓炸薯條單位、煎肉餅單位、包裝單位...)掌握各期所需生產的半成品、原料單位數量  



  -  **基本範例**:

      | 單位名稱 | 型態 | 說明 | 備註  |
      |-|-|-|-|
      | BOM_NO | CHAR(10) | BOM編號 | 主鍵（PK）  |
      | MATNR | CHAR(40) | 物料號碼（零件號碼） | 外鍵（FK），連接物料主數據表  |
      | COMPONENT | CHAR(40) | 子零件號碼 |   |
      | QUANTITY | DECIMAL(13,3) | 子零件數量 |   |
      | UOM | CHAR(3) | 單位（如件、公斤、米） |   |
      | LVL | INT | 階層等級（1=最終產品，2=次級部件） |   |
      | SCRAP | DECIMAL(5,2) | 損耗率百分比 |   |
      | VALID_FROM | DATE | 生效日期 |   |
      | VALID_TO | DATE | 失效日期 |   |


- **銷售訂單（Sales Order, SO）與需求預測（Demand Forecast）** :   
  -  **功能**:   
  銷售訂單與需求預測分別對應最上層的確定需求和預測需求。  
  銷售訂單是客戶向企業下達的產品訂單，具體描述了所需產品的型號、數量、交期等信息。  
  代表了具體的客戶需求，通常來自市場部門或銷售部門。  
  需求預測則是銷售部門或市場部門，基於歷史數據、市場分析、季節變化等因素，對未來的各產品需求數量進行預測

  
  -  **用途**:  
  不論是銷售訂單還是需求預測，都是公司制定生產規劃的最上層資訊，一般會根據這兩個資訊進一步展開主生產計畫 (MPS)

- **主生產計畫 (Master Production Schedule, MPS)** :   

  -  **功能**:   
  基於銷售訂單、需求預測、庫存狀況和生產能力等因素制定的產品生產計劃，
  是企業的中短期生產計劃，通常以週、日等時間單位來顯示未來一段時間(月、季)內的生產安排(跟產品cycle time)  

  -  **用途**:  
  物料需求計劃 (MRP) 的輸入基礎，決定了哪些產品在什麼時候生產以及生產多少，

- **物料需求計劃表 (Material Requirements Planning Table, MRP)** : 
    -  **功能**:   
  是一種計劃生產和管理庫存的系統，用來確保在生產過程中所需的半成品物料、零部件和組件可以及時提供，以滿足生產需求，
  就像是定時準備足夠分量的薯條(半成品物料)，讓隨時有訂單下來時都有薯條可以組成套餐出貨  

  

- **計畫訂單表 (Planned Orders)** :   

  -  **功能**:   
  基於上述資訊(MPS、MRP)制定的具體訂單，內容包括具體的訂單明細和生產排程，反映了實際的生產需求和計劃。  
  對於排程議題而言計畫訂單就是基本要生產的單位，有生產安排的資訊，  
  就像是告訴產線說計畫每10分鐘要生產5個漢堡、下午5點前要煮完2鍋玉米濃湯...  

  -  **用途**:  
  計畫訂單是一種內部生產計劃的形式，尚未轉換為實際的生產製令(僅代表預期要做)。   
  當企業確認了物料供應、產能等條件後，計畫訂單可以轉換為實際的生產訂單（即工單 work order） 
  所以排程實際上，就是在排這些計畫訂單!!!!  
  評估各生產能否及時完成、安排生產順序規劃、決定分配生產單位、向上回報是否需要調整生產計畫(來不及做完)...  


  -  **基本範例**:
      | 欄位 | 說明 | 備註 |
      | - | - | -|
      | 計畫訂單號 |  成品或半成品的內部計畫單號 | PK |
      |品號 |  產品料號 | |
      | 計劃生產數量 |   | |
      | 計劃生產日期 |   ||
      | 優先級 |  工單的優先等級 | 不一定需要，實務也可能會根據業務資訊、客戶、專案類別等去決定|


  **在製品工單/WIP工單(Work in process)** :  
  -  **功能**:   
  一般 WIP 指的是在生產過程中尚未完成的產品，  
  故WIP工單泛稱已經確認要生產的計畫訂單，
  一些公司的生管會將計畫訂單轉為生產工單，依產能狀況在系統上新增該生產批號

  排程的時候，特別是對於排程顆粒度較細、或製造周期較長的在製工單，
  這些在製品工單就是必須要考量的項目，  
  掌握其在產線上所屬站點、未結數量，  
  一般還會由MES(製造執行系統)記錄其所屬狀態（Wait、Run、Hold 等）  




### 其他排程相關紀錄表
- **機群/工作中心表** :  
所有的工作中心以及其相關資訊，需要能跟生產途程表下的各工作中心名稱對應，  
留意有些企業可能因報帳需求、MES紀錄方式等不同情境會有不同工作中心名稱劃分或稱呼方式。  

- **機台表** :  
所有的機台、生產單位的清單，也有可能是人力站點

- **機群機台對照表** :  
該機群可以使用機台的對照表，  
因為不同機群有可能可以使用相同的機台，  
若有人力站點的該人力可以作多種不同的行為時也是相同概念。  




 







-------------------------
### Backup:
- https://mosaik.readthedocs.io/en/latest/scheduler.html
